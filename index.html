<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rex大叔的可轉債資料庫</title>
    <style>
        /* 簡單乾淨的樣式，不花俏 */
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1, h2 { text-align: center; color: #0056b3; }
        
        /* 統計資訊區塊 */
        .stats-box {
            background: #eef2f5;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 0.9em;
            line-height: 1.6;
        }

        /* 表格樣式 */
        .table-container {
            overflow-x: auto; /* 手機上可左右滑動 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            white-space: nowrap; /* 避免內容換行太醜 */
        }
        th {
            background-color: #0056b3; /* Rex藍 */
            color: white;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) { background-color: #f2f2f2; }
        tr:hover { background-color: #e6f7ff; }

        .error { color: red; font-weight: bold; text-align: center; margin: 20px; }
    </style>
</head>
<body>

    <h1>Rex大叔 - AI智能可轉債競拍系統</h1>
    
    <div id="statsDisplay" class="stats-box" style="display:none;">
        <h3>資料庫統計摘要</h3>
        <div id="statsContent"></div>
    </div>

    <h2>詳細資料列表</h2>
    <div class="table-container">
        <table id="cbTable">
            <thead id="tableHead"></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    
    <div id="statusMsg" style="text-align:center; margin-top:20px;">正在讀取資料...</div>

<script>
    // 設定檔名 (與你的 GitHub 截圖一致)
    const DATA_FILE = './cb_data_integrated.json';

    // 啟動讀取
    fetch(DATA_FILE)
        .then(response => {
            if (!response.ok) throw new Error("無法找到檔案，請確認檔名是否正確。");
            return response.json();
        })
        .then(data => {
            console.log("原始數據:", data); // 開發者工具可看
            document.getElementById('statusMsg').style.display = 'none';
            processData(data);
        })
        .catch(err => {
            document.getElementById('statusMsg').innerHTML = `<div class="error">讀取失敗：${err.message}</div>`;
        });

    function processData(data) {
        let listData = [];
        let statsData = null;

        // 1. 嘗試解析結構：分辨哪個是統計，哪個是清單
        // 判斷邏輯：如果 data 本身就是陣列 -> 直接用
        // 如果 data 是物件，去找裡面哪個 value 是陣列
        
        if (Array.isArray(data)) {
            listData = data;
        } else {
            // 它是物件，我們來找找看鑰匙
            if (data["統計數據"]) {
                statsData = data["統計數據"];
            }
            
            // 優先尋找可能的清單名稱
            if (data["競拍原始資料"] && Array.isArray(data["競拍原始資料"])) {
                listData = data["競拍原始資料"];
            } else if (data["CB資料庫"] && Array.isArray(data["CB資料庫"])) {
                listData = data["CB資料庫"];
            } else if (data["data"] && Array.isArray(data["data"])) {
                listData = data["data"];
            } else {
                // 如果找不到明顯的名字，就找裡面任何一個是陣列的東西
                for (let key in data) {
                    if (Array.isArray(data[key])) {
                        listData = data[key];
                        break; // 找到第一個陣列就當作是它了
                    }
                }
            }
        }

        // 2. 顯示統計數據 (如果有)
        if (statsData) {
            renderStats(statsData);
        }

        // 3. 顯示表格
        if (listData.length > 0) {
            renderTable(listData);
        } else {
            document.getElementById('statusMsg').innerHTML = 
                `<div class="error">資料庫讀取成功，但找不到可顯示的列表資料(Array)。<br>請確認 JSON 內是否包含 '競拍原始資料' 或 'CB資料庫' 陣列。</div>`;
            document.getElementById('statusMsg').style.display = 'block';
        }
    }

    function renderStats(stats) {
        const container = document.getElementById('statsDisplay');
        const content = document.getElementById('statsContent');
        container.style.display = 'block';
        
        // 簡單把統計數據轉成文字顯示
        // 這裡只抓第一層或"資料期間"
        let html = "";
        if (stats["資料期間"]) {
            html += `<strong>資料期間：</strong> ${stats["資料期間"]["開始日期"]} ~ ${stats["資料期間"]["結束日期"]} (總筆數: ${stats["資料期間"]["總筆數"]})<br>`;
        }
        content.innerHTML = html;
    }

    function renderTable(data) {
        const thead = document.getElementById('tableHead');
        const tbody = document.getElementById('tableBody');
        
        // 取得所有欄位名稱 (從第一筆資料)
        const columns = Object.keys(data[0]);

        // 建立表頭
        let headerHTML = "<tr>";
        columns.forEach(col => {
            headerHTML += `<th>${col}</th>`;
        });
        headerHTML += "</tr>";
        thead.innerHTML = headerHTML;

        // 建立內容
        let bodyHTML = "";
        data.forEach(row => {
            bodyHTML += "<tr>";
            columns.forEach(col => {
                let val = row[col];
                // 如果值是物件(例如裡面還有細項)，轉成文字以免顯示 [object Object]
                if (typeof val === 'object' && val !== null) {
                    val = JSON.stringify(val); 
                }
                bodyHTML += `<td>${val !== null ? val : ''}</td>`;
            });
            bodyHTML += "</tr>";
        });
        tbody.innerHTML = bodyHTML;
    }
</script>

</body>
</html>
