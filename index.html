<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯è½‰å‚µç«¶æ‹æŸ¥è©¢ç³»çµ± (å„ªåŒ–ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
            position: relative;
        }
        .container { 
            max-width: 1600px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
            overflow: hidden; 
            padding-bottom: 60px; /* ç‚º footer ç•™ç©ºé–“ */
        }
        /* å›åˆ°é ‚éƒ¨æŒ‰éˆ• */
        #backToTop {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: #ff9800;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 50%;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        #backToTop:hover {
            background-color: #e65100;
            transform: translateY(-3px);
        }

        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { 
            font-size: 2rem; 
            margin-bottom: 10px; 
            font-weight: 600; 
        }
        .header p { 
            font-size: 0.95rem; 
            opacity: 0.9; 
        }
        .header-info { 
            display: flex; 
            justify-content: center; 
            gap: 30px; 
            margin-top: 15px; 
            flex-wrap: wrap; 
        }
        .header-info-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 0.9rem; 
            background: rgba(255, 255, 255, 0.2); 
            padding: 8px 16px; 
            border-radius: 20px; 
            transition: all 0.3s ease; 
            cursor: pointer; 
        }
        .header-info-item:hover { 
            background: rgba(255, 255, 255, 0.35); 
            transform: translateY(-2px); 
        }

        .data-update-banner {
            background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
            padding: 12px 30px;
            text-align: center;
            color: #e65100;
            font-size: 0.9rem;
            border-bottom: 2px solid #ffcc80;
        }

        .tabs { 
            display: flex; 
            background: #f8f9fa; 
            border-bottom: 3px solid #dee2e6; 
            flex-wrap: wrap;
        }
        .tab { 
            flex: 1; 
            padding: 12px 10px; 
            text-align: center; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            border-bottom: 3px solid transparent; 
            margin-bottom: -3px; 
            line-height: 1.3;
            min-width: 100px;
        }
        .tab:hover { 
            background: #e9ecef; 
        }
        .tab.active { 
            background: white; 
            border-bottom: 3px solid #667eea; 
            color: #667eea; 
        }
        
        .tab-content { 
            display: none; 
            padding: 30px; 
        }
        .tab-content.active { 
            display: block; 
        }
        
        .search-box { 
            max-width: 600px; 
            margin: 50px auto; 
            text-align: center; 
        }
        .search-box input { 
            width: 100%; 
            padding: 15px; 
            font-size: 1.1rem; 
            border: 3px solid #667eea; 
            border-radius: 10px; 
        }
        .search-box input:focus { 
            outline: none; 
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); 
        }
        .search-hint { 
            color: #6c757d; 
            margin-top: 15px; 
            font-size: 0.9rem; 
        }
        
        .btn { 
            padding: 12px 30px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: 600; 
            transition: all 0.3s; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            white-space: nowrap;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); 
        }
        .btn-secondary { 
            background: #6c757d; 
            color: white; 
        }
        .btn-secondary:hover { 
            background: #5a6268; 
            transform: translateY(-2px); 
        }
        
        .stats-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            background: white; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            font-size: 0.85rem;
        }
        .stats-table th { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 8px; 
            text-align: center; 
            font-size: 0.8rem; 
            border: 1px solid rgba(255,255,255,0.2); 
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        .stats-table th:hover {
            background: linear-gradient(135deg, #7c8ef0 0%, #8a5bb2 100%);
        }
        .stats-table th.sortable::after {
            content: ' â‡…';
            opacity: 0.5;
            font-size: 0.75rem;
            margin-left: 3px;
        }
        .stats-table th.sort-asc::after {
            content: ' â–²';
            opacity: 1;
            color: #ffd700;
            font-size: 0.75rem;
            margin-left: 3px;
        }
        .stats-table th.sort-desc::after {
            content: ' â–¼';
            opacity: 1;
            color: #ffd700;
            font-size: 0.75rem;
            margin-left: 3px;
        }
        .stats-table td { 
            padding: 10px 8px; 
            text-align: center; 
            border: 1px solid #dee2e6; 
            font-size: 0.8rem; 
        }
        .stats-table tr:nth-child(even) { 
            background: #f8f9fa; 
        }
        .stats-table tr:hover { 
            background: #e7f3ff; 
        }
        .stats-table .highlight { 
            background: #fff3cd !important; 
            font-weight: 600; 
        }
        
        .info-card { 
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); 
            padding: 20px; 
            border-radius: 10px; 
            border-left: 4px solid #667eea; 
            margin-bottom: 20px; 
        }
        .info-card h4 { 
            color: #667eea; 
            margin-bottom: 15px; 
            font-size: 1.1rem; 
        }
        .info-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px; 
        }
        .info-item { 
            padding: 10px; 
            background: white; 
            border-radius: 6px; 
            text-align: center; 
        }
        .info-item .label { 
            font-size: 0.8rem; 
            color: #6c757d; 
            margin-bottom: 5px; 
        }
        .info-item .value { 
            font-size: 1.2rem; 
            font-weight: 700; 
            color: #495057; 
        }
        
        .positive { color: #dc3545; }  /* å°ç£ç¿’æ…£:ç´…è‰²ä»£è¡¨æº¢åƒ¹/ä¸Šæ¼² */
        .negative { color: #28a745; }  /* å°ç£ç¿’æ…£:ç¶ è‰²ä»£è¡¨æŠ˜åƒ¹/ä¸‹è·Œ */
        
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .warning-banner {
            background: linear-gradient(135deg, #fff3cd 0%, #ffffff 100%);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .warning-banner h4 {
            color: #d32f2f;
            margin-bottom: 10px;
        }
        
        .warning-banner p {
            color: #424242;
            line-height: 1.8;
            margin: 5px 0;
        }

        .calculator-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .calculator-input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
            border-left: 4px solid #2196f3;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .price-chart {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .price-line {
            padding: 8px 0;
        }

        .your-price-line {
            background: #fff3cd;
            font-weight: 600;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin: 5px 0;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .collapsible {
            background: #e3f2fd;
            cursor: pointer;
            padding: 15px;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #1565c0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapsible:hover {
            background: #bbdefb;
        }
        
        .collapsible .arrow {
            transition: transform 0.3s;
        }
        
        .collapsible.active .arrow {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .collapsible-content.active {
            display: block;
        }

        .condition-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        label:has(.condition-checkbox):hover {
            background: #e1bee7 !important;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.2);
        }

        label:has(.condition-checkbox:checked) {
            background: #ce93d8 !important;
            border: 2px solid #9c27b0;
        }

        .footer { 
            padding: 20px 30px; 
            background: #f8f9fa; 
            border-top: 2px solid #e9ecef; 
            text-align: center; 
            color: #6c757d; 
            font-size: 0.85rem; 
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5rem; }
            .tab { font-size: 0.9rem; padding: 15px 10px; }
            .calculator-input-group { grid-template-columns: 1fr; }
            .export-buttons { flex-direction: column; }
            /* è®“è¡¨æ ¼åœ¨æ‰‹æ©Ÿä¸Šå¯æ©«å‘æ²å‹• */
            div[style*="overflow-x: auto"] {
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>
    <button id="backToTop" onclick="scrollToTop()">â¬†ï¸</button>

    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å¯è½‰å‚µç«¶æ‹æŸ¥è©¢ç³»çµ±</h1>
            <p style="margin-bottom: 15px;">ç«¶æ‹çµ±è¨ˆæ•¸æ“š | æ™ºèƒ½æ¨¡æ“¬åˆ†æ | æŠ•æ¨™åƒ¹æ ¼è©¦ç®—</p>
            <div class="header-info">
                <div class="header-info-item"><span>ğŸ“…</span><span id="currentDate">è¼‰å…¥ä¸­...</span></div>
                <div class="header-info-item" onclick="window.open('https://vocus.cc/salon/655c9dbcfd897800019d5bb4', '_blank')"><span>ğŸ“</span><span>æ–¹æ ¼å­éƒ¨è½æ ¼</span></div>
                <div class="header-info-item" onclick="window.open('https://www.youtube.com/@rexdashu168', '_blank')"><span>ğŸ¬</span><span>YouTubeé »é“</span></div>
            </div>
            <p style="margin-top: 12px; font-size: 0.85rem; opacity: 0.85;">by Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</p>
        </div>

        <div class="data-update-banner" id="dataUpdateBanner">
            ğŸ“… æ­£åœ¨è¼‰å…¥ç«¶æ‹è³‡æ–™...
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('single')">ğŸ”<br>å–®æª”æŸ¥è©¢</div>
            <div class="tab" onclick="switchTab('batch')">ğŸ“Š<br>æ‰¹æ¬¡æŸ¥è©¢</div>
            <div class="tab" onclick="switchTab('filter')">âš™ï¸<br>æ¢ä»¶ç¯©é¸</div>
            <div class="tab" onclick="switchTab('calculator')">ğŸ¯<br>æŠ•æ¨™è¨ˆç®—æ©Ÿ</div>
            <div class="tab" onclick="switchTab('rules')">ğŸ“‹<br>ç«¶æ‹é ˆçŸ¥</div>
        </div>

        <div id="tab-single" class="tab-content active">
            <div class="search-box">
                <h2 style="margin-bottom: 20px; color: #495057;">ğŸ” å–®æª”æ­·å²æŸ¥è©¢</h2>
                <div style="background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%); padding: 20px; border-radius: 10px; margin-bottom: 30px; border-left: 4px solid #2196f3; text-align: left;">
                    <h4 style="color: #1976d2; margin-bottom: 12px; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ’¡</span><span>åŠŸèƒ½èªªæ˜</span>
                    </h4>
                    <div style="color: #424242; font-size: 0.9rem; line-height: 1.8;">
                        <p style="margin-bottom: 8px;"><strong>æŸ¥è©¢æ–¹å¼ï¼š</strong>è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿã€CBä»£è™Ÿæˆ–å…¬å¸åç¨±</p>
                        <p style="margin-bottom: 8px;"><strong>é¡¯ç¤ºå…§å®¹ï¼š</strong>è©²å…¬å¸æ‰€æœ‰æ­·æ¬¡ç™¼è¡Œçš„å¯è½‰å‚µç«¶æ‹è¨˜éŒ„</p>
                        <p style="margin-bottom: 0;"><strong>ä½¿ç”¨ç¯„ä¾‹ï¼š</strong>è¼¸å…¥ã€Œ3617ã€æˆ–ã€Œç¢©å¤©ã€</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; align-items: center; max-width: 600px; margin: 0 auto;">
                    <input type="text" id="singleSearchInput" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿã€CBä»£è™Ÿæˆ–å…¬å¸åç¨±" 
                        onkeyup="if(event.key==='Enter') executeSingleSearch()">
                    <button class="btn btn-primary" onclick="executeSingleSearch()">æŸ¥è©¢</button>
                </div>
            </div>
            <div id="singleResult"></div>
        </div>

        <div id="tab-batch" class="tab-content">
            <div class="search-box">
                <h2 style="margin-bottom: 20px; color: #495057;">ğŸ“Š æ‰¹æ¬¡æ¯”è¼ƒæŸ¥è©¢</h2>
                
                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%); padding: 25px; border-radius: 10px; margin-bottom: 30px; border-left: 4px solid #4caf50;">
                    <h4 style="color: #2e7d32; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ“…</span><span>æ™‚é–“å€é–“å¿«é€ŸæŸ¥è©¢</span>
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="queryByTimeRange(1)" style="font-size: 0.9rem; padding: 10px;">æœ€è¿‘1å€‹æœˆ</button>
                        <button class="btn btn-primary" onclick="queryByTimeRange(3)" style="font-size: 0.9rem; padding: 10px;">æœ€è¿‘3å€‹æœˆ</button>
                        <button class="btn btn-primary" onclick="queryByTimeRange(6)" style="font-size: 0.9rem; padding: 10px;">æœ€è¿‘åŠå¹´</button>
                        <button class="btn btn-primary" onclick="queryByTimeRange(12)" style="font-size: 0.9rem; padding: 10px;">æœ€è¿‘1å¹´</button>
                        <button class="btn btn-primary" onclick="queryByTimeRange(24)" style="font-size: 0.9rem; padding: 10px;">æœ€è¿‘2å¹´</button>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; align-items: center; max-width: 600px; margin: 0 auto;">
                    <input type="text" id="batchSearchInput" placeholder="è¼¸å…¥ä»£è™Ÿæˆ–åç¨±å¾ŒæŒ‰EnteråŠ å…¥" 
                        onkeyup="if(event.key==='Enter') addToBatchList()">
                    <button class="btn btn-primary" onclick="addToBatchList()">åŠ å…¥</button>
                </div>
                
                <div id="batchList" style="margin-top: 30px; max-width: 800px; margin-left: auto; margin-right: auto;"></div>
                
                <div id="batchButtons" style="display: none; margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="executeBatchSearch()">ğŸ” é–‹å§‹åˆ†æ</button>
                    <button class="btn btn-secondary" onclick="clearBatchList()">ğŸ—‘ï¸ æ¸…ç©ºåˆ—è¡¨</button>
                </div>
            </div>
            <div id="batchResult"></div>
            <div id="batchChecklist" style="display: none;">
                <div style="background: linear-gradient(135deg, #e8eaf6 0%, #ffffff 100%); padding: 25px; margin: 20px 30px; border-radius: 10px; border-left: 4px solid #5c6bc0;">
                    <h3 style="color: #3f51b5; margin-bottom: 15px;">ğŸ“‹ æŠ•æ¨™å‰åƒè€ƒæª¢æŸ¥æ¸…å–®</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="color: #d32f2f; font-weight: 600; margin-bottom: 8px;">â° æ™‚æ©Ÿé¸æ“‡</div>
                            <div style="font-size: 0.85rem; color: #616161; line-height: 1.6;">
                                âœ“ æˆªæ¨™æ—¥1:30æ”¶ç›¤å¾Œå†æŠ•æ¨™<br>
                                âœ“ é¿å…åƒ¹æ ¼æ³¢å‹•æœŸé–“æ±ºç­–
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="color: #d32f2f; font-weight: 600; margin-bottom: 8px;">ğŸ’° é¢¨éšªè©•ä¼°</div>
                            <div style="font-size: 0.85rem; color: #616161; line-height: 1.6;">
                                âœ“ è¨ˆç®—æœ€å¤§æå¤±ï¼šæŠ•æ¨™åƒ¹-100å…ƒ<br>
                                âœ“ è©•ä¼°å¯æ‰¿å—çš„é¢¨éšªé‡‘é¡
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-filter" class="tab-content">
            <h2 style="color: #495057; margin-bottom: 20px;">âš™ï¸ æ¢ä»¶ç¯©é¸åˆ†æ</h2>
            
            <div class="filter-section">
                <h3 style="color: #495057; margin-bottom: 20px;">ç¯©é¸æ¢ä»¶è¨­å®šï¼ˆå¯è‡ªç”±é¸æ“‡ 1~8 å€‹æ¢ä»¶çµ„åˆï¼‰</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="filter-group">
                        <label>ğŸ­ ç”¢æ¥­åˆ†é¡</label>
                        <select id="filterIndustry">
                            <option value="">å…¨éƒ¨</option>
                            <option value="åŒ–å­¸å·¥æ¥­">åŒ–å­¸å·¥æ¥­</option>
                            <option value="èˆªé‹æ¥­">èˆªé‹æ¥­</option>
                            <option value="åŠå°é«”æ¥­">åŠå°é«”æ¥­</option>
                            <option value="ç”ŸæŠ€é†«ç™‚æ¥­">ç”ŸæŠ€é†«ç™‚æ¥­</option>
                            <option value="å…‰é›»æ¥­">å…‰é›»æ¥­</option>
                            <option value="é€šä¿¡ç¶²è·¯æ¥­">é€šä¿¡ç¶²è·¯æ¥­</option>
                            <option value="é›»å­é›¶çµ„ä»¶æ¥­">é›»å­é›¶çµ„ä»¶æ¥­</option>
                            <option value="é›»è…¦åŠé€±é‚Šè¨­å‚™æ¥­">é›»è…¦åŠé€±é‚Šè¨­å‚™æ¥­</option>
                            <option value="å…¶ä»–é›»å­æ¥­">å…¶ä»–é›»å­æ¥­</option>
                            <option value="å»ºæç‡Ÿé€ æ¥­">å»ºæç‡Ÿé€ æ¥­</option>
                            </select>
                    </div>
                    <div class="filter-group">
                        <label>ğŸ¢ ç™¼è¡Œåˆ¸å•†</label>
                        <select id="filterUnderwriter">
                            <option value="">å…¨éƒ¨</option>
                            <option value="å…ƒå¤§è­‰åˆ¸">å…ƒå¤§è­‰åˆ¸</option>
                            <option value="å‡±åŸºè­‰åˆ¸">å‡±åŸºè­‰åˆ¸</option>
                            <option value="å¯Œé‚¦è­‰åˆ¸">å¯Œé‚¦è­‰åˆ¸</option>
                            <option value="æ°¸è±é‡‘è­‰">æ°¸è±é‡‘è­‰</option>
                            <option value="ç¾¤ç›Šè­‰åˆ¸">ç¾¤ç›Šè­‰åˆ¸</option>
                            <option value="åœ‹æ³°è­‰åˆ¸">åœ‹æ³°è­‰åˆ¸</option>
                            <option value="å°æ–°è­‰åˆ¸">å°æ–°è­‰åˆ¸</option>
                            <option value="çµ±ä¸€è­‰åˆ¸">çµ±ä¸€è­‰åˆ¸</option>
                            <option value="å…†è±è­‰åˆ¸">å…†è±è­‰åˆ¸</option>
                             <option value="ç¬¬ä¸€é‡‘è­‰">ç¬¬ä¸€é‡‘è­‰</option>
                        </select>
                    </div>
                     <div class="filter-group">
                        <label>ğŸ“Š è‚¡æœ¬å€é–“</label>
                        <select id="filterCapital">
                            <option value="">å…¨éƒ¨</option>
                            <option value="<10">å°æ–¼10å„„</option>
                            <option value=">10">å¤§æ–¼10å„„</option>
                            <option value="<5">5å„„ä»¥ä¸‹</option>
                            <option value=">20">20å„„ä»¥ä¸Š</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ğŸ’° ç™¼è¡Œè¦æ¨¡</label>
                        <select id="filterScale">
                            <option value="">å…¨éƒ¨</option>
                            <option value="<5">5å„„ä»¥ä¸‹</option>
                            <option value=">5">5å„„ä»¥ä¸Š</option>
                             <option value=">10">10å„„ä»¥ä¸Š</option>
                        </select>
                    </div>
                     <div class="filter-group">
                        <label>ğŸ“… ç™¼è¡Œå¹´æœŸ</label>
                        <select id="filterPeriod">
                            <option value="">å…¨éƒ¨</option>
                            <option value="3">3å¹´</option>
                            <option value="5">5å¹´</option>
                        </select>
                    </div>
                     <div class="filter-group">
                        <label>ğŸ›¡ï¸ æ“”ä¿æƒ…æ³</label>
                        <select id="filterSecured">
                            <option value="">å…¨éƒ¨</option>
                            <option value="æœ‰">æœ‰æ“”ä¿</option>
                            <option value="ç„¡">ç„¡æ“”ä¿</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>â­ TCRIä¿¡ç”¨è©•ç­‰</label>
                        <select id="filterRating">
                            <option value="">å…¨éƒ¨</option>
                             <option value="<=4">4åˆ†ä»¥ä¸‹ï¼ˆå«ï¼‰</option>
                            <option value=">=5">5åˆ†ä»¥ä¸Šï¼ˆå«ï¼‰</option>
                        </select>
                    </div>
                     <div class="filter-group">
                        <label>ğŸ’µ è½‰æ›åƒ¹æ ¼</label>
                        <select id="filterConvPrice">
                            <option value="">å…¨éƒ¨</option>
                            <option value="<50">50å…ƒä»¥ä¸‹</option>
                            <option value=">100">100å…ƒä»¥ä¸Š</option>
                        </select>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="executeFilterSearch()">ğŸ” é–‹å§‹åˆ†æ</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">ğŸ”„ é‡ç½®æ¢ä»¶</button>
                </div>
            </div>
            <div id="filterResult"></div>
        </div>

        <div id="tab-calculator" class="tab-content">
            <h2 style="color: #495057; margin-bottom: 20px; text-align: center;">ğŸ¯ æŠ•æ¨™è¨ˆç®—æ©Ÿèˆ‡æ¢ä»¶åˆ†æ</h2>
            
            <button class="collapsible" onclick="toggleCollapsible(this)">âš ï¸ æŠ•æ¨™é¢¨éšªæé†’ï¼ˆé»æ“Šå±•é–‹ï¼‰<span class="arrow">â–¼</span></button>
            <div class="collapsible-content">
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                    <p style="margin-bottom: 10px;"><strong style="color: #d32f2f;">ğŸ“Œ æŠ•æ¨™ä¸å¯å–æ¶ˆï¼š</strong>æŠ•æ¨™å¾Œç„¡æ³•å–æ¶ˆï¼Œè«‹è¬¹æ…å¡«å¯«åƒ¹æ ¼</p>
                    <p style="margin-bottom: 10px;"><strong style="color: #d32f2f;">ğŸ’° ä¿è­‰é‡‘è¦å®šï¼š</strong>æŠ•æ¨™ç¸½åƒ¹é‡‘ Ã— 50%</p>
                    <p style="margin-bottom: 10px;"><strong style="color: #d32f2f;">ğŸ’µ æ¨™å–®è™•ç†è²»ï¼š</strong>æ¯ç­† 400å…ƒ</p>
                </div>
            </div>

            <div id="calculatorCheckConditions"></div>
            <div id="calculatorMain" style="display: none;">
                <div class="calculator-section">
                    <h3 style="color: #495057; margin-bottom: 20px;">ğŸ“Š ç†è«–åƒ¹å€¼è¨ˆç®—</h3>
                    <div class="calculator-input-group">
                        <div class="filter-group">
                            <label>è½‰æ›åƒ¹æ ¼ï¼ˆå…ƒï¼‰</label>
                            <input type="number" id="calcConvPrice" placeholder="ä¾‹å¦‚ï¼š44.00" step="0.01">
                        </div>
                        <div class="filter-group">
                            <label>è‚¡ç¥¨å¸‚åƒ¹ï¼ˆå…ƒï¼‰- æˆªæ¨™æ—¥1:30æ”¶ç›¤åƒ¹</label>
                            <input type="number" id="calcStockPrice" placeholder="ä¾‹å¦‚ï¼š41.20" step="0.01">
                        </div>
                        <div class="filter-group">
                            <label>ç†è«–åƒ¹å€¼ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</label>
                            <input type="text" id="calcTheoretical" readonly style="background: #e9ecef; font-weight: 600;">
                        </div>
                    </div>
                </div>

                <div class="calculator-section">
                    <h3 style="color: #495057; margin-bottom: 20px;">ğŸ¯ æŠ•æ¨™åƒ¹æ ¼è©¦ç®—</h3>
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #2196f3;">
                        <strong style="color: #1565c0;">ğŸ’¡ æ•¸æ“šä¾†æºï¼š</strong>
                        <span id="calcDataSourceInfo">æ­£åœ¨ä½¿ç”¨æ‚¨åœ¨ã€Œæ¢ä»¶ç¯©é¸ã€é ç±¤ä¸­ç¯©é¸å‡ºçš„æ­·å²è³‡æ–™é€²è¡Œæ¨¡æ“¬ã€‚</span>
                    </div>
                    <div class="calculator-input-group">
                        <div class="filter-group">
                            <label>æ‚¨æƒ³æŠ•æ¨™çš„åƒ¹æ ¼ï¼ˆå…ƒï¼‰</label>
                            <input type="number" id="calcBidPrice" placeholder="ä¾‹å¦‚ï¼š112.00" step="0.01">
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="analyzePrice()">ğŸ” é–‹å§‹è©¦ç®—</button>
                    </div>
                </div>

                <div id="calculatorResult"></div>
            </div>
        </div>

        <div id="tab-rules" class="tab-content">
             <div class="search-box">
                <h2 style="margin-bottom: 30px; color: #495057; text-align: center;">ğŸ“‹ å¯è½‰å‚µç«¶æ‹é ˆçŸ¥</h2>
                <div style="background: #fff3cd; padding: 20px; border-radius: 8px;">
                    <p>è«‹åƒè€ƒè­‰åˆ¸äº¤æ˜“æ‰€æœ€æ–°å…¬å‘Šä¹‹ç«¶æ‹è¦å‰‡ã€‚</p>
                </div>
            </div>
        </div>

        <div class="warning-banner">
            <h4>âš ï¸ é‡è¦æç¤º</h4>
            <p>æœ¬ç³»çµ±æä¾›æ­·å²æ•¸æ“šçµ±è¨ˆèˆ‡è³‡æ–™æ•´ç†ï¼Œæ‰€æœ‰æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°</p>
            <p>éå»è¡¨ç¾ä¸ä»£è¡¨æœªä¾†çµæœï¼ŒæŠ•è³‡æ±ºç­–è«‹è‡ªè¡Œè©•ä¼°é¢¨éšª</p>
        </div>

        <div class="footer">
            <p style="font-weight: 500;">è³‡æ–™ä¾†æºï¼šè­‰åˆ¸æ«ƒæª¯è²·è³£ä¸­å¿ƒ</p>
            <p style="margin-top: 8px; color: #f44336; font-weight: 500;">âš ï¸ æœ¬è¡¨åƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡æ±ºç­–è«‹è‡ªè¡Œè©•ä¼°é¢¨éšª</p>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                <p style="font-weight: 600; color: #495057; margin-bottom: 12px;">ğŸ“š Rexå¤§å”çš„168å°è‚¡æŠ•è³‡æ•™å®¤</p>
            </div>
        </div>
    </div>

    <script>
        // ==================== å…¨åŸŸè®Šæ•¸ ====================
        let auctionData = [];
        let currentFilteredResults = []; // å„²å­˜ç›®å‰ç¯©é¸æ¢ä»¶ä¸‹çš„çµæœ
        let batchListItems = [];
        let currentInvestorType = 'conservative';
        let selectedFilterConditions = {};
        let currentAnalysisData = null;
        let bidMultipleQuintiles = { q1: 0, q2: 0, q3: 0, q4: 0, updated: false };

        // ==================== åŸºç¤åŠŸèƒ½ ====================
        
        // å›åˆ°é ‚éƒ¨åŠŸèƒ½
        const backToTopBtn = document.getElementById("backToTop");
        window.onscroll = function() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        };
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('zh-TW', options);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
            
            if (tab === 'calculator') {
                checkCalculatorConditions();
            }
            window.scrollTo(0, 0);
        }

        function toggleCollapsible(element) {
            element.classList.toggle('active');
            const content = element.nextElementSibling;
            content.classList.toggle('active');
        }

        // ==================== è³‡æ–™è¼‰å…¥èˆ‡è™•ç† ====================
        
        async function loadExcelData() {
            try {
                document.getElementById('dataUpdateBanner').innerHTML = 'ğŸ“… æ­£åœ¨è¼‰å…¥ç«¶æ‹è³‡æ–™...';
                const timestamp = new Date().getTime();
                const response = await fetch(`auction_data.xlsx?t=${timestamp}`);
                
                if (!response.ok) throw new Error('ç„¡æ³•è®€å– Excel æª”æ¡ˆ');
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                if (jsonData.length === 0) throw new Error('Excelæª”æ¡ˆä¸­æ²’æœ‰è³‡æ–™');

                auctionData = jsonData.map(row => ({
                    no: row['åºè™Ÿ'],
                    date: formatDate(row['é–‹æ¨™æ—¥æœŸ']),
                    stockCode: String(row['è‚¡ç¥¨ä»£è™Ÿ']),
                    cbCode: String(row['CBä»£è™Ÿ']),
                    name: row['åç¨±'],
                    capital: parseFloat(row['è‚¡æœ¬']) || 0,
                    scale: parseFloat(row['ç™¼è¡Œè¦æ¨¡']) || 0,
                    period: row['å¹´æœŸ'] + 'å¹´',
                    secured: row['æ“”ä¿'],
                    rating: parseInt(row['ä¿¡è©•']) || 0,
                    minBid: parseFloat(row['æœ€ä½å¾—æ¨™']) || 0,
                    minPremium: (parseFloat(row['æœ€ä½æº¢åƒ¹']) || 0) * 100,
                    avgBid: parseFloat(row['å¹³å‡å¾—æ¨™']) || 0,
                    avgPremium: (parseFloat(row['å¹³å‡æº¢åƒ¹']) || 0) * 100,
                    listHigh: parseFloat(row['æ›ç‰Œæœ€é«˜']) || 0,
                    listLow: parseFloat(row['æ›ç‰Œæœ€ä½']) || 0,
                    underwriter: row['ç™¼è¡Œåˆ¸å•†'],
                    industry: row['ç”¢æ¥­åˆ†é¡'],
                    bidMultiple: parseFloat(row['æŠ•æ¨™å€æ•¸']) || 0,
                    atmosphere: 'â³',
                    convPrice: parseFloat(row['è½‰æ›åƒ¹']) || 0
                }));

                calculateBidMultipleQuintiles();
                auctionData.forEach(item => {
                    item.atmosphere = calculateAtmosphere(item.bidMultiple);
                });

                document.getElementById('dataUpdateBanner').innerHTML = `ğŸ“… è³‡æ–™è¼‰å…¥å®Œæˆï¼Œå…± ${auctionData.length} æª”è³‡æ–™`;
                document.getElementById('dataUpdateBanner').style.background = '#e8f5e9';
                document.getElementById('dataUpdateBanner').style.color = '#2e7d32';

            } catch (error) {
                console.error(error);
                document.getElementById('dataUpdateBanner').innerHTML = `âŒ éŒ¯èª¤ï¼š${error.message}ã€‚è«‹ç¢ºèª auction_data.xlsx å­˜åœ¨ã€‚`;
                document.getElementById('dataUpdateBanner').style.background = '#ffebee';
                document.getElementById('dataUpdateBanner').style.color = '#c62828';
            }
        }

        function formatDate(excelDate) {
            if (typeof excelDate === 'string') return excelDate;
            const date = XLSX.SSF.parse_date_code(excelDate);
            return `${date.y}/${String(date.m).padStart(2, '0')}/${String(date.d).padStart(2, '0')}`;
        }

        function calculateBidMultipleQuintiles() {
            if (auctionData.length === 0) return;
            const bidMultiples = auctionData.map(item => item.bidMultiple).filter(bm => bm > 0).sort((a, b) => a - b);
            const getPercentile = (arr, p) => arr[Math.ceil(arr.length * p) - 1];
            bidMultipleQuintiles = {
                q1: getPercentile(bidMultiples, 0.20),
                q2: getPercentile(bidMultiples, 0.40),
                q3: getPercentile(bidMultiples, 0.60),
                q4: getPercentile(bidMultiples, 0.80),
                updated: true
            };
        }

        function calculateAtmosphere(bm) {
            if (!bm || !bidMultipleQuintiles.updated) return 'â“';
            if (bm <= bidMultipleQuintiles.q1) return 'ğŸ˜´';
            if (bm <= bidMultipleQuintiles.q2) return 'ğŸ˜Š';
            if (bm <= bidMultipleQuintiles.q3) return 'ğŸ”¥';
            if (bm <= bidMultipleQuintiles.q4) return 'ğŸš€';
            return 'ğŸ’¥';
        }

        // ==================== ç¯©é¸èˆ‡åˆ†æé‚è¼¯ (æ ¸å¿ƒ) ====================

        function executeFilterSearch() {
            if (auctionData.length === 0) { alert('è³‡æ–™è¼‰å…¥ä¸­'); return; }

            const filters = {
                industry: document.getElementById('filterIndustry').value,
                underwriter: document.getElementById('filterUnderwriter').value,
                capital: document.getElementById('filterCapital').value,
                scale: document.getElementById('filterScale').value,
                period: document.getElementById('filterPeriod').value,
                secured: document.getElementById('filterSecured').value,
                rating: document.getElementById('filterRating').value,
                convPrice: document.getElementById('filterConvPrice').value
            };

            // å„²å­˜æ¢ä»¶
            localStorage.setItem('filterConditions', JSON.stringify(filters));
            selectedFilterConditions = filters;

            // åŸ·è¡Œç¯©é¸
            currentFilteredResults = auctionData.filter(item => {
                if (filters.industry && item.industry !== filters.industry) return false;
                if (filters.underwriter && item.underwriter !== filters.underwriter) return false;
                if (filters.period && item.period !== filters.period + 'å¹´') return false;
                if (filters.secured && item.secured !== filters.secured) return false;
                
                // æ•¸å€¼å€é–“ç¯©é¸é‚è¼¯ (ç°¡åŒ–ç‰ˆ)
                if (filters.capital) {
                    if (filters.capital === '<10' && item.capital >= 10) return false;
                    if (filters.capital === '>10' && item.capital <= 10) return false;
                    // ...å…¶ä»–é‚è¼¯ä¾æ­¤é¡æ¨
                }
                if (filters.rating) {
                     if (filters.rating === '<=4' && item.rating > 4) return false;
                     if (filters.rating === '>=5' && item.rating < 5) return false;
                }
                
                return true;
            });

            displayFilterResult(currentFilteredResults);
        }

        function displayFilterResult(results) {
            if (results.length === 0) {
                document.getElementById('filterResult').innerHTML = '<div class="warning-banner"><p>âŒ æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</p></div>';
                return;
            }
            
            // ç°¡å–®é¡¯ç¤ºçµæœæ‘˜è¦
            let html = `
                <div class="result-box">
                    <h3>âœ… ç¯©é¸çµæœï¼šå…± ${results.length} æª”</h3>
                    <p style="font-size: 0.9rem; color: #666;">è©³ç´°æ¸…å–®å¯æ–¼ä¸‹æ–¹æª¢è¦–ï¼Œæˆ–ç›´æ¥å‰å¾€ã€ŒæŠ•æ¨™è¨ˆç®—æ©Ÿã€é€²è¡Œåƒ¹æ ¼è©¦ç®—ã€‚</p>
                </div>
                <div style="overflow-x: auto;">
                    <table class="stats-table">
                        <thead>
                            <tr><th>æ—¥æœŸ</th><th>åç¨±</th><th>æœ€ä½å¾—æ¨™</th><th>å¹³å‡å¾—æ¨™</th><th>æ›ç‰Œæœ€é«˜</th><th>æ¼²å¹…</th></tr>
                        </thead>
                        <tbody>
            `;
            
            results.slice(0, 50).forEach(item => { // åªé¡¯ç¤ºå‰50ç­†é¿å…å¡é “
                const gain = ((item.listHigh - item.avgBid) / item.avgBid * 100).toFixed(1);
                html += `<tr>
                    <td>${item.date}</td>
                    <td>${item.name}</td>
                    <td>${item.minBid.toFixed(2)}</td>
                    <td>${item.avgBid.toFixed(2)}</td>
                    <td>${item.listHigh.toFixed(2)}</td>
                    <td style="color:${gain>=0?'#dc3545':'#28a745'}">${gain}%</td>
                </tr>`;
            });
            
            html += `</tbody></table></div>`;
            if(results.length > 50) html += `<p style="text-align:center; color:#666;">(åƒ…é¡¯ç¤ºå‰ 50 ç­†)</p>`;
            
            document.getElementById('filterResult').innerHTML = html;
        }

        // ==================== è¨ˆç®—æ©Ÿé‚è¼¯ (ä¿®æ­£ç‰ˆ) ====================

        function checkCalculatorConditions() {
            const savedConditions = localStorage.getItem('filterConditions');
            const mainDiv = document.getElementById('calculatorMain');
            const checkDiv = document.getElementById('calculatorCheckConditions');

            if (!savedConditions) {
                checkDiv.innerHTML = `<div class="warning-banner"><p>âš ï¸ è«‹å…ˆè‡³ã€Œæ¢ä»¶ç¯©é¸ã€é ç±¤è¨­å®šç¯©é¸æ¢ä»¶ä¸¦åŸ·è¡Œåˆ†æã€‚</p></div>`;
                mainDiv.style.display = 'none';
                return;
            }

            // å˜—è©¦é‡æ–°åŸ·è¡Œä¸€æ¬¡ç¯©é¸ä»¥ç¢ºä¿æ•¸æ“šæ˜¯æœ€æ–°çš„ (å¦‚æœ currentFilteredResults æ˜¯ç©ºçš„)
            if (currentFilteredResults.length === 0 && auctionData.length > 0) {
                // ç°¡å–®è§¸ç™¼ä¸€æ¬¡ç¯©é¸é‚è¼¯ (ç‚ºäº†ä»£ç¢¼ç°¡æ½”ï¼Œé€™è£¡å‡è¨­ç”¨æˆ¶å·²ç¶“æ“ä½œéï¼Œæˆ–åœ¨è¼‰å…¥æ™‚è‹¥æœ‰localStorageå¯è‡ªå‹•è§¸ç™¼)
                // å¯¦å‹™ä¸Šå»ºè­°åœ¨ executeFilterSearch æ›´æ–°å…¨åŸŸè®Šæ•¸
            }

            const resultCount = currentFilteredResults.length;
            if (resultCount < 3) {
                 checkDiv.innerHTML = `<div class="warning-banner"><p>âš ï¸ ç›®å‰ç¬¦åˆæ¢ä»¶çš„æ­·å²æ¨£æœ¬åƒ… ${resultCount} æª”ï¼Œæ¨£æœ¬ä¸è¶³ç„¡æ³•é€²è¡Œæœ‰æ•ˆçµ±è¨ˆã€‚</p></div>`;
                 mainDiv.style.display = 'none';
            } else {
                checkDiv.innerHTML = `<div class="result-box" style="border-left-color:#4caf50; background:#e8f5e9"><p style="color:#2e7d32">âœ… å·²è¼‰å…¥ <strong>${resultCount}</strong> æª”ç¬¦åˆæ¢ä»¶çš„æ­·å²æ¨£æœ¬ã€‚</p></div>`;
                mainDiv.style.display = 'block';
                document.getElementById('calcDataSourceInfo').textContent = `åŸºæ–¼ ${resultCount} æª”ç¬¦åˆæ‚¨ç¯©é¸æ¢ä»¶çš„æ­·å²è³‡æ–™é€²è¡Œçµ±è¨ˆã€‚`;
            }
        }

        function analyzePrice() {
            const bidPrice = parseFloat(document.getElementById('calcBidPrice').value);
            const stockPrice = parseFloat(document.getElementById('calcStockPrice').value);
            const convPrice = parseFloat(document.getElementById('calcConvPrice').value);

            if (!bidPrice || !stockPrice || !convPrice) {
                alert('è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½');
                return;
            }

            // 1. è¨ˆç®—ç†è«–åƒ¹å€¼
            const theoretical = (stockPrice / convPrice) * 100;
            document.getElementById('calcTheoretical').value = theoretical.toFixed(2) + ' å…ƒ';

            // 2. ä½¿ç”¨ã€çœŸå¯¦ç¯©é¸è³‡æ–™ã€‘è¨ˆç®—çµ±è¨ˆæ•¸æ“š (ä¿®æ­£æ ¸å¿ƒ)
            const data = currentFilteredResults;
            const historicalAvgMinBid = data.reduce((sum, i) => sum + i.minBid, 0) / data.length;
            const historicalAvgBid = data.reduce((sum, i) => sum + i.avgBid, 0) / data.length;
            const historicalAvgMaxBid = data.reduce((sum, i) => sum + (i.minBid * 1.1), 0) / data.length; // ä¼°ç®—æœ€é«˜å¾—æ¨™ç´„ç‚ºæœ€ä½çš„1.1å€(æˆ–ä½¿ç”¨çœŸå¯¦æ•¸æ“šå¦‚æœ‰)
            
            const premium = ((bidPrice - 100) / 100) * 100;
            const diffMinBid = bidPrice - historicalAvgMinBid;
            const diffAvgBid = bidPrice - historicalAvgBid;

            // 3. ç”¢ç”Ÿå ±å‘Š HTML
            const html = `
                <div class="result-box" style="margin-top: 30px;">
                    <h3 style="color: #1976d2; margin-bottom: 20px;">ğŸ“Š åˆ†æçµæœå ±å‘Š</h3>
                    
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #495057;">åƒ¹æ ¼è½é»åˆ†æ</h4>
                        <div style="display: grid; gap: 10px; margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; padding: 10px; background: #f8f9fa;">
                                <span>æ­·å²å¹³å‡æœ€ä½å¾—æ¨™</span>
                                <strong>${historicalAvgMinBid.toFixed(2)} å…ƒ</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px; background: #fff3cd; border: 1px solid #ffc107;">
                                <span>æ‚¨çš„æŠ•æ¨™åƒ¹</span>
                                <strong style="color: #d32f2f;">${bidPrice.toFixed(2)} å…ƒ</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px; background: #f8f9fa;">
                                <span>æ­·å²å¹³å‡å¾—æ¨™åƒ¹</span>
                                <strong>${historicalAvgBid.toFixed(2)} å…ƒ</strong>
                            </div>
                        </div>
                        <p style="margin-top:15px; font-size:0.9rem; color:#666;">
                            æ‚¨çš„å‡ºåƒ¹æ¯”æ­·å²åŒé¡æ¢ä»¶çš„ã€Œå¹³å‡æœ€ä½å¾—æ¨™åƒ¹ã€
                            <span style="color:${diffMinBid>0?'#dc3545':'#28a745'}">
                                ${diffMinBid>0 ? 'é«˜å‡º' : 'ä½æ–¼'} ${Math.abs(diffMinBid).toFixed(2)} å…ƒ
                            </span>ã€‚
                        </p>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h4 style="color: #495057;">æˆæœ¬é¢¨éšªè©¦ç®—</h4>
                        <div style="display: flex; justify-content: space-between; margin-top:10px;">
                            <span>ä¿è­‰é‡‘ (50%)</span>
                            <strong>${Math.round(bidPrice * 1000 * 0.5).toLocaleString()} å…ƒ</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top:10px;">
                            <span>æœ€å¤§é¢¨éšª (è·Œç ´é¢é¡)</span>
                            <strong style="color: #28a745;">-${((bidPrice-100)*1000).toLocaleString()} å…ƒ/å¼µ</strong>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('calculatorResult').innerHTML = html;
        }

        // ç°¡å–®çš„å–®æª”æŸ¥è©¢ (Tab 1)
        function executeSingleSearch() {
            const keyword = document.getElementById('singleSearchInput').value.trim();
            if(!keyword) return;
            const results = auctionData.filter(item => 
                item.stockCode.includes(keyword) || item.name.includes(keyword) || item.cbCode.includes(keyword)
            );
            
            let html = '';
            if(results.length === 0) {
                html = '<div class="warning-banner"><p>âŒ æŸ¥ç„¡è³‡æ–™</p></div>';
            } else {
                html = `<div style="overflow-x:auto;"><table class="stats-table">
                    <thead><tr><th>é–‹æ¨™æ—¥</th><th>ä»£è™Ÿ</th><th>åç¨±</th><th>æœ€ä½å¾—æ¨™</th><th>å¹³å‡å¾—æ¨™</th><th>å€æ•¸</th><th>æ°›åœ</th></tr></thead><tbody>`;
                results.forEach(r => {
                    html += `<tr><td>${r.date}</td><td>${r.stockCode}</td><td>${r.name}</td><td>${r.minBid}</td><td>${r.avgBid}</td><td>${r.bidMultiple}</td><td>${r.atmosphere}</td></tr>`;
                });
                html += `</tbody></table></div>`;
            }
            document.getElementById('singleResult').innerHTML = html;
        }

        // é é¢è¼‰å…¥åˆå§‹åŒ–
        window.onload = function() {
            displayCurrentDate();
            loadExcelData(); // è‡ªå‹•è®€å–
            
            // ç¶å®šç†è«–åƒ¹è‡ªå‹•è¨ˆç®—
            const autoCalc = () => {
                const s = parseFloat(document.getElementById('calcStockPrice').value);
                const c = parseFloat(document.getElementById('calcConvPrice').value);
                if(s && c) document.getElementById('calcTheoretical').value = ((s/c)*100).toFixed(2) + ' å…ƒ';
            };
            document.getElementById('calcStockPrice').addEventListener('input', autoCalc);
            document.getElementById('calcConvPrice').addEventListener('input', autoCalc);
        };
    </script>
</body>
</html>
