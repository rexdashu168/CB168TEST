        // ==========================================
        // å„ªåŒ–ç‰ˆï¼šAIè©•ä¼°è¨ˆç®—å¼•æ“ï¼ˆè³‡æ–™é©…å‹• + å®‰å…¨é˜²è­·ï¼‰
        // ==========================================
        
        // 1. æ–°å¢ï¼šå®‰å…¨è®€å–è³‡æ–™çš„è¼”åŠ©å‡½å¼
        function getSafePremium(category, key, defaultValue = 0) {
            try {
                // æª¢æŸ¥ statistics æ˜¯å¦å­˜åœ¨
                if (!statistics || !statistics['ç¶­åº¦çµ±è¨ˆ']) {
                    console.error('âŒ çµ±è¨ˆæ•¸æ“šæœªè¼‰å…¥');
                    return defaultValue;
                }

                // å˜—è©¦è®€å–è·¯å¾‘
                const categoryData = statistics['ç¶­åº¦çµ±è¨ˆ'][category];
                if (!categoryData) {
                    console.warn(`âš ï¸ æ‰¾ä¸åˆ°åˆ†é¡: ${category}`);
                    return defaultValue;
                }

                const itemData = categoryData[key];
                if (!itemData) {
                    console.warn(`âš ï¸ æ‰¾ä¸åˆ°é …ç›®: ${category} -> ${key}`);
                    // å¦‚æœæ‰¾ä¸åˆ°è©²å…·é«”é …ç›®ï¼ˆä¾‹å¦‚æŸå€‹å†·é–€ç”¢æ¥­ï¼‰ï¼Œå›å‚³ 0 (ä¸åŠ åˆ†ä¹Ÿä¸æ‰£åˆ†)
                    return defaultValue;
                }

                // æª¢æŸ¥æ˜¯å¦æœ‰ã€Œå¹³å‡æœ€ä½æº¢åƒ¹ã€æ¬„ä½
                if (itemData['å¹³å‡æœ€ä½æº¢åƒ¹'] === undefined) {
                    console.warn(`âš ï¸ é …ç›®ç„¡æº¢åƒ¹æ•¸æ“š: ${category} -> ${key}`);
                    return defaultValue;
                }

                return itemData['å¹³å‡æœ€ä½æº¢åƒ¹'];

            } catch (e) {
                console.error(`âŒ è®€å–æ•¸æ“šéŒ¯èª¤ (${category} -> ${key}):`, e);
                return defaultValue;
            }
        }

        function calculateEvaluation(data) {
            console.log('ğŸš€ é–‹å§‹è³‡æ–™é©…å‹•AIè©•ä¼°...', data);
            
            // æ­¥é©Ÿ1ï¼šè¨ˆç®—ç†è«–åƒ¹æ ¼
            const theoreticalPrice = (data.stockPrice / data.conversionPrice) * 100;
            
            // æ­¥é©Ÿ2ï¼šæŸ¥è¡¨å–å¾—å„ç¶­åº¦æº¢åƒ¹ (ä½¿ç”¨ getSafePremium å–ä»£ç›´æ¥è®€å–)
            const premiums = {};
            
            // 2.1 ç”¢æ¥­æº¢åƒ¹
            premiums.industry = getSafePremium('ç”¢æ¥­', data.industry);
            
            // 2.2 ç™¼è¡Œè¦æ¨¡æº¢åƒ¹
            let sizeRange = '';
            if (data.issueSize < 2) sizeRange = '<2å„„';
            else if (data.issueSize < 5) sizeRange = '2-5å„„';
            else if (data.issueSize < 10) sizeRange = '5-10å„„';
            else if (data.issueSize < 15) sizeRange = '10-15å„„';
            else if (data.issueSize < 20) sizeRange = '15-20å„„';
            else sizeRange = '>20å„„';
            premiums.size = getSafePremium('ç™¼è¡Œè¦æ¨¡', sizeRange);
            
            // 2.3 è‚¡æœ¬æº¢åƒ¹
            let capitalRange = '';
            if (data.capital < 3) capitalRange = '<3å„„';
            else if (data.capital < 6) capitalRange = '3-6å„„';
            else if (data.capital < 10) capitalRange = '6-10å„„';
            else if (data.capital < 15) capitalRange = '10-15å„„';
            else if (data.capital < 20) capitalRange = '15-20å„„';
            else capitalRange = '>20å„„';
            premiums.capital = getSafePremium('è‚¡æœ¬', capitalRange);
            
            // 2.4 å¹´æœŸæº¢åƒ¹ (æ³¨æ„ï¼šç¢ºä¿ key æ˜¯ "3å¹´" è€Œä¸æ˜¯ "3")
            const yearsKey = data.years.toString().includes('å¹´') ? data.years : data.years + 'å¹´';
            premiums.years = getSafePremium('å¹´æœŸ', yearsKey);
            
            // 2.5 æ“”ä¿æº¢åƒ¹
            premiums.guarantee = getSafePremium('æ“”ä¿', data.guarantee);
            
            // 2.6 ä¿¡è©•æº¢åƒ¹
            premiums.rating = getSafePremium('ä¿¡è©•', data.rating);
            
            // 2.7 è½‰æ›åƒ¹æº¢åƒ¹
            let convRange = '';
            if (data.conversionPrice < 20) convRange = '<20å…ƒ';
            else if (data.conversionPrice < 50) convRange = '20-50å…ƒ';
            else if (data.conversionPrice < 100) convRange = '50-100å…ƒ';
            else if (data.conversionPrice < 150) convRange = '100-150å…ƒ';
            else if (data.conversionPrice < 200) convRange = '150-200å…ƒ';
            else convRange = '>200å…ƒ';
            premiums.conversion = getSafePremium('è½‰æ›åƒ¹', convRange);
            
            // 2.8 ç†è«–åƒ¹æº¢åƒ¹ï¼ˆæœ€é‡è¦ï¼ï¼‰
            let theoRange = '';
            // ç¢ºä¿é€™è£¡çš„å­—ä¸²èˆ‡ JSON ä¸­çš„ key å®Œå…¨ä¸€è‡´
            if (theoreticalPrice < 85) theoRange = '<85å…ƒ';
            else if (theoreticalPrice < 90) theoRange = '85-90å…ƒ';
            else if (theoreticalPrice < 95) theoRange = '90-95å…ƒ';
            else if (theoreticalPrice < 98) theoRange = '95-98å…ƒ';
            else if (theoreticalPrice < 100) theoRange = '98-100å…ƒ';
            else if (theoreticalPrice < 102) theoRange = '100-102å…ƒ';
            else if (theoreticalPrice < 105) theoRange = '102-105å…ƒ';
            else if (theoreticalPrice < 110) theoRange = '105-110å…ƒ';
            else theoRange = '>110å…ƒ';
            premiums.theoretical = getSafePremium('ç†è«–åƒ¹', theoRange);
            
            // 2.9 å¸‚å ´æ°›åœèª¿æ•´ (åŒæ¨£åŠ å…¥å®‰å…¨æª¢æŸ¥)
            premiums.market = 0;
            if (statistics['å¸‚å ´æ°›åœ'] && statistics['å¸‚å ´æ°›åœ']['è¿‘3æœˆ']) {
                premiums.market = statistics['å¸‚å ´æ°›åœ']['è¿‘3æœˆ']['å»ºè­°èª¿æ•´'] || 0;
            }
            
            // æ­¥é©Ÿ3ï¼šåŠ æ¬Šå¹³å‡è¨ˆç®—
            const weights = {
                theoretical: 0.30,
                guarantee: 0.20,    
                industry: 0.15,     
                size: 0.10,         
                rating: 0.10,       
                conversion: 0.08,   
                years: 0.05,        
                capital: 0.02       
            };
            
            let comprehensivePremium = 
                premiums.theoretical * weights.theoretical +
                premiums.guarantee * weights.guarantee +
                premiums.industry * weights.industry +
                premiums.size * weights.size +
                premiums.rating * weights.rating +
                premiums.conversion * weights.conversion +
                premiums.years * weights.years +
                premiums.capital * weights.capital +
                premiums.market;
            
            // æ­¥é©Ÿ4ï¼šè¨ˆç®—æŠ•æ¨™åƒ¹æ ¼
            const theoreticalBidPrice = theoreticalPrice * (1 + comprehensivePremium / 100);
            
            const bidPrices = {
                conservative: (theoreticalBidPrice * 0.95).toFixed(2),
                balanced: (theoreticalBidPrice * 1.00).toFixed(2),
                aggressive: (theoreticalBidPrice * 1.05).toFixed(2)
            };
            
            // è¿”å›çµæœ
            return {
                cbName: data.cbName,
                theoreticalPrice: theoreticalPrice.toFixed(2),
                premiums: premiums,
                comprehensivePremium: comprehensivePremium.toFixed(2),
                theoreticalBidPrice: theoreticalBidPrice.toFixed(2),
                bidPrices: bidPrices,
                inputData: data,
                ranges: {
                    size: sizeRange,
                    capital: capitalRange,
                    conversion: convRange,
                    theoretical: theoRange
                }
            };
        }
